{% extends 'base.html' %}
{% block title %}Etiqueta: #{{ tag }} – Blog de Videojuegos{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-center">
    🏷️ Posts con la etiqueta: <span class="text-info">#{{ tag }}</span>
  </h2>

  {% if posts %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for post in posts %}
      <div class="col">
        <div class="card h-100 bg-dark text-light shadow-sm">
          {% if post.imagen %}
          <a href="{% url 'detalle_post' post.id %}">
            <img
              src="{{ post.imagen.url }}"
              class="card-img-top img-fluid"
              style="aspect-ratio:1/1; object-fit:cover;"
              alt="{{ post.titulo }}"
            >
          </a>
          {% endif %}
          <div class="card-body d-flex flex-column p-3">
            <h5 class="card-title">
              <a href="{% url 'detalle_post' post.id %}" class="text-light text-decoration-none">
                {{ post.titulo }}
              </a>
            </h5>
            <p class="card-text small text-muted mb-2">
              🧑 {{ post.autor.username }}<br>
              📅 {{ post.fecha_creacion|date:"d/m/Y" }}<br>
              💬 {{ post.comentario_set.count }} comentario{{ post.comentario_set.count|pluralize }}
            </p>
            <p class="card-text mb-3">
              {{ post.contenido|striptags|truncatechars:150 }}
            </p>

            {% if post.tags.all %}
            <div class="mt-auto">
              <p class="mb-0"><strong>Etiquetas:</strong>
                {% for t in post.tags.all %}
                  <a href="{% url 'posts_por_tag' t.nombre %}" class="badge bg-secondary text-decoration-none me-1">
                    {{ t.nombre }}
                  </a>
                {% endfor %}
              </p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    {% if posts.has_other_pages %}
    <nav class="mt-4">
      <ul class="pagination justify-content-center">
        {% if posts.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ posts.previous_page_number }}">« Anterior</a>
        </li>
        {% endif %}
        {% for i in posts.paginator.page_range %}
        <li class="page-item {% if posts.number == i %}active{% endif %}">
          <a class="page-link" href="?page={{ i }}">{{ i }}</a>
        </li>
        {% endfor %}
        {% if posts.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ posts.next_page_number }}">Siguiente »</a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}

  {% else %}
    <div class="alert alert-info text-center">
      🕸️ No se encontraron publicaciones con esta etiqueta.
    </div>
  {% endif %}
</div>
{% endblock %}
